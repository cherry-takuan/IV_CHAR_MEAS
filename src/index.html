<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>サイン波表示</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
<h1>サイン波表示</h1>
<button onclick="start()">開始</button>
<button onclick="stop()">停止</button>
<label>ステップ:
    <input type="number" id="step" value="0.1" step="0.1">
    <button onclick="setStep()">送信</button>
</label>
<div id="chart" style="width:600px;height:400px;"></div>

<script>
let ws;
let xData = [], yData = [];

// WebSocket接続
function connectWS() {
    ws = new WebSocket("ws://127.0.0.1:8000/ws");
    ws.onmessage = (event) => {
        const point = JSON.parse(event.data);
        xData.push(point.x);
        yData.push(point.y);
        Plotly.newPlot('chart', [{
            x: xData,
            y: yData,
            mode: 'lines'
        }], {
            title: 'サイン波',
            xaxis: { title: 'x' },
            yaxis: { title: 'y', range: [-1.2, 1.2] }
        });
    };
}

function start() {
    fetch("http://127.0.0.1:8000/start", {method: "POST"});
}

function stop() {
    fetch("http://127.0.0.1:8000/stop", {method: "POST"});
}

function setStep() {
    const val = document.getElementById("step").value;
    fetch(`http://127.0.0.1:8000/set_step/${val}`, {method: "POST"});
}

// ページ読み込み時に接続
connectWS();
</script>
</body>
</html>